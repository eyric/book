# 系统设计思维导图

![](<../.gitbook/assets/image (135).png>)

## 系统设计

### 基础

#### 性能

#### 伸缩性

#### 扩展性

#### 可用性

#### 安全性

### 分布式

#### 分布式锁

* 阻塞锁通常使用互斥量来实现
* 数据库的唯一索引
  *
    * 锁没有失效时间，解锁失败的话其它进程无法再获得该锁。
* 只能是非阻塞锁，插入失败直接就报错了，无法重试。
* 不可重入，已经获得锁的进程也必须重新获取锁。
* Redis 的 SETNX 指令
* Redis 的 RedLock 算法
* Zookeeper 的有序节点

#### 分布式事务

* 本地消息表
* 2PC（两阶段提交）
  * 通过引入协调者（Coordinator）来协调参与者的行为，并最终决定这些参与者是否要真正执行事务。

#### 分布式 ID

#### CAP

* 分布式系统不可能同时满足一致性（C：Consistency）、可用性（A：Availability）和分区容忍性（P：Partition Tolerance），最多只能同时满足其中两项。

#### BASE

* BASE 是基本可用（Basically Available）、软状态（Soft State）和最终一致性（Eventually Consistent）三个短语的缩写。

#### Paxos

* 用于达成共识性问题，即对多个节点产生的值，该算法能保证只选出唯一一个值。

主要有三类节点：

* 提议者（Proposer）：提议一个值；
* 接受者（Acceptor）：对每个提议进行投票；
* 告知者（Learner）：被告知投票的结果，不参与投票过程。

#### Raft

* Raft 也是分布式一致性协议，主要是用来竞选主节点

### 集群

#### 负载均衡

* 轮询（Round Robin）
* 加权轮询（Weighted Round Robbin）
* 最少连接（least Connections）
* 加权最少连接（Weighted Least Connection）
* 随机算法（Random）
* 源地址哈希法 (IP Hash)

#### Session 管理

* Sticky Session
* Session Replication
* Session Server

### 缓存

#### 缓存特征

#### LRU

#### 缓存位置

#### CDN

#### 缓存问题

* 缓存穿透
* 缓存雪崩
* 缓存一致性

#### 一致性哈希

### 攻击技术

#### XSS

#### CSRF

#### SQL 注入

#### DDoS

### 消息队列

#### 消息模型

* 点对点
* 发布订阅

#### 使用场景

* 解耦
* 异步
* 削峰

#### 可靠性

#### RabbitMQ/ActiveMQ/RockitMQ/Kakfa

#### 如何保证消息队列的高可用

* RabbitMQ:镜像集群
* Kafka:HA机制

#### 如何保证消息队列的幂等性：全局唯一的ID

#### 如何保证消息的可靠传输：确认机制

#### 如何保证消息的可靠性：每个消费者对应一个queue

#### 如何设计消息队列

* 消息的传输
  * JMS
  * AMQP
* 消息的存储
  * 文件系统
  * 内存
  * noSQL
  * db
* 消费关系维护
* 高级功能
  * 消息的顺序 /投递可靠性保证 消息持久化 /支持不同消息模型 /多实例集群功能 /事务特性等

### 高并发系统

#### 秒杀系统

* 主要解决两个问题：并发读、并发写。高可用（保证系统的高可用和正确性，设计PlanB进行兜底）、一致性（保证秒杀减库存中的数据一致性）、高性能（涉及大量并发读写，所以需要支持高并发，从动静分离、热点发现与隔离、请求削峰与分层过滤、服务端极致优化）
* 五个架构原则
  * 数据尽量少
  * 请求数尽量少
  * 路径尽量短
  * 依赖尽量少：将服务分级，比如将支付服务作为0级，优惠券是1级，要避免0级系统被1级系统拖垮。
  * 不要有单点：单点意味着没有备份。将服务无状态化，即避免服务与机器绑定。可设置配置中心映射。
* 动静分离/缓存/限流/减少编码和序列化/直接使用servlet/写要求强一致性，读不要求
* 二八原则
* 库存系统
  * 减库存方式
    * 下单减库存
    * 支付减库存
    * 预扣库存：保留15分钟

#### 限流算法

* 令牌桶算法
* 漏桶算法
* 计数器限流

#### 服务熔断与服务降级

* 服务熔断：应对雪崩效应的一种微服务链路的保护机制

### 服务拆分

#### 幂等性

#### 远程服务访问方法

#### 微服务

#### SOA

### 系统设计

#### Web 页面请求过程

* 确定协议(http/https)DNS（DHCP，ARP，负载均衡）http会话(长连接/短连接)建立TCP连接(三次握手)数据传输(报文,封装，拆解)释放TCP连接(四次挥手)HTTP响应浏览器渲染（js/css/缓存）

#### 二维码登录

#### TinyURL

#### KV 存储系统

#### 搜索引擎

__

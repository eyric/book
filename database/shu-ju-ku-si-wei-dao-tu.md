# 数据库思维导图

![](../.gitbook/assets/image%20%28131%29.png)

## 数据库

### SQL

#### 手写分组查询

#### 手写连接查询

* 单表：自链接
* 多表
  * 内连接
    * 等值连接
    * 不等连接
    * 自然连接
  * 外连接
    * 左连接
    * 右连接
    * 全连接
  * 交叉连接

#### 连接与子查询

#### drop、delete、truncate

#### 视图

* 为了保障数据安全性，提高查询效率

#### 存储过程

#### 触发器

### 系统原理

#### ACID

* 原子性
* 隔离性
* 一致性
* 持久性

#### 隔离级别

* 读未提交
* 读已提交
* 可重复读
* 串行化
* 并发一致性问题：丢失修改、读脏数据、不可重复读、幻读

#### 封锁

* 封锁粒度：表级锁、行级锁
* 封锁类型：读写锁\(X,S）、意向锁\(X,IX,S,IS\)
* 三级封锁协议，两段锁协议\(加锁与解锁分阶段进行，串行化调度必要条件\)
* 显示锁定与隐式锁定：select for update,select lock in share mode

#### 乐观锁与悲观锁

#### MVCC（多版本并发控制）：InnoDB实现读已提交和可重复度隔离级别的一种方式 （版本号，隐藏的列，undo日志）

#### Next-Key Locks:解决幻读

* Record Locks:锁定一个记录的索引而不是记录本身
* Gap Locks：锁定索引之间的间隙，但不包括索引本身

#### 范式

#### SQL 与 NoSQL

#### 死锁

* 事务交替执行
* 并发修改同一条记录
* 索引不当导致全表扫描
* 事务封锁范围大且相互等待
  * 批量插入/NK重叠

#### 缓存一致性

* 读：先读缓存，cache miss再读数据库
* 写：先写数据库，再淘汰缓存

### MySQL

#### B+ Tree

* 主索引
* 辅助索引

#### 索引以及优化

* 分类：B+树索引，哈希索引，全文索引\(MyISAM\)，空间数据索引
* 聚集索引：数据行的物理顺序与列值（一般是主键的那一列）的逻辑顺序相同，一个表中只能拥有一个聚集索引
* 非聚集索引：该索引中索引的逻辑顺序与磁盘上行的物理存储顺序不同，一个表中可以拥有多个非聚集索引。
* 优化
  * 独立的列：查询时索引列不能是表达式或函数参数
  * 多列索引：需要多个列作为条件进行查询时，多列索引性能更高
  * 索引列的顺序：选择性强的索引放前面
  * 前缀索引：对于blob,text,varchar类型的列，必须使用前缀索引，只索引开始的部分字符
  * 覆盖索引：索引包含所有需要查询的字段的值

#### 查询优化

* 使用explain进行分析：查询类型，使用的索引，扫描的行数
* 优化数据访问
  * 减少请求的数据量：只返回必要的列和行，缓冲重复查询
  * 减少服务端扫描的行数：使用索引覆盖查询
* 重构查询方式
  * 切分大查询：大查询锁住很多数据，占满整个事务日志
  * 分解大连接查询：对单表查询，在程序中关联：高效缓存、减少锁竞争、减少数据冗余

#### InnoDB 与 MyISAM

* 事务
* 并发
* 外键
* 备份
* 系统崩溃
* MyISAM支持表压缩和空间数据索引

#### 水平切分与垂直切分

* sharding
  * 策略：哈希取模，范围，映射表
  * 问题：事务，连接，ID唯一性

#### 主从复制

* binlog线程：将主服务器的数据更改写入二进制日志
* I/O线程：将主服务器的日志写入从服务器的中继日志
* SQL线程：读取中继日志并更新到从服务器
* 读写分离
  * 减少锁竞争、从服务器使用myISAM提高查询性能、增加冗余提高可用性

#### 日志

### Redis

#### 字典和跳跃表

#### 使用场景

#### 与 Memchached 的比较

#### RDB 和 AOF 持久化机制

#### 数据淘汰机制

#### 事件驱动模型

#### 主从复制

#### 集群与分布式

#### 事务

#### 线程安全问题

\_\_

